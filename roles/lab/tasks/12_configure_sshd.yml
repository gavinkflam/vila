---
- name: install sshd configuration file
  template: "src={{ item.src }} dest={{ item.dest }}"
  with_items:
    - src: config/sshd/sshd_config.j2
      dest: /etc/ssh/sshd_config
  become: true

# Generate host keys
- name: create sshd host keys directory
  file: "path=/etc/ssh/host_keys state=directory"
  become: true

- name: generate fresh rsa key for sshd
  command: <
    ssh-keygen -f /etc/ssh/host_keys/ssh_host_rsa_key -N '' -t rsa && \
      chmod 600 /etc/ssh/host_keys/ssh_host_rsa_key
  args:
    creates: /etc/ssh/host_keys/ssh_host_rsa_key
  become: true

- name: generate fresh dsa key for sshd
  command: <
    ssh-keygen -f /etc/ssh/host_keys/ssh_host_dsa_key -N '' -t dsa && \
      chmod 600 /etc/ssh/host_keys/ssh_host_dsa_key
  args:
    creates: /etc/ssh/host_keys/ssh_host_dsa_key
  become: true
